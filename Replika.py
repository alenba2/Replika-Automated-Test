# Generated by Selenium IDE
from pyexpat.errors import messages

import pytest
import time
import json
from selenium import webdriver
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.common.by import By
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities

from nltk.corpus import stopwords
from nltk.tokenize import word_tokenize

globeList = []
pass_number = 0
total_test = 8

#YOUR EMAIL AND PASSWORD GO HERE
email = ""
password = ""

class TestTest1():
    def setup_method(self, method):
        self.driver = webdriver.Chrome(executable_path=ChromeDriverManager().install())
        self.vars = {}

    def teardown_method(self, method):
        self.driver.quit()

    def getMessages(self, heading1):

        messages = []

        for x in heading1:
            try:
                heading2 = x.find_element(By.TAG_NAME, 'span')
                message = heading2.get_attribute('innerHTML')
                messages.append(message)
            except:
                pass

        return messages

    def getSimilarity(self, response, keyword):

        response = response.lower()

        x = word_tokenize(response)
        y = word_tokenize(keyword)

        sw = stopwords.words('english')
        l1 = []
        l2 = []

        X_set = {w for w in x if not w in sw}
        Y_set = {w for w in y if not w in sw}

        rvector = X_set.union(Y_set)
        for w in rvector:
            if w in X_set:
                l1.append(1)  # create a vector
            else:
                l1.append(0)
            if w in Y_set:
                l2.append(1)
            else:
                l2.append(0)
        c = 0

        # cosine formula
        for i in range(len(rvector)):
            c += l1[i] * l2[i]
        cosine = c / float((sum(l1) * sum(l2)) ** 0.5)
        print("\nsimilarity: ", cosine)

    # TEST #1
    def test_test1(self):

        self.driver.get("https://my.replika.com/login")
        self.driver.set_window_size(1200, 900)
        self.driver.find_element(By.ID, "emailOrPhone").send_keys(email)
        self.driver.find_element(By.ID, "emailOrPhone").send_keys(Keys.ENTER)
        time.sleep(1)
        self.driver.find_element(By.ID, "login-password").send_keys(password)
        self.driver.find_element(By.CSS_SELECTOR, ".SolidButton-k70ct8-0").click()
        time.sleep(5)

        self.driver.execute_script("window.scrollTo(0,0)")

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Hello") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Thanks, how are you?")
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("What are you doing right now?") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Nothing as interesting as that lol. What music are you listening to?") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Who is the president of the United States?")
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Â¿Cual es la capital de Paraguay?")
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("was ist die hauptstadt von Deutschland?")
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("My favorite color is Red.")
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("What is My favorite color?")
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(10)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Did you hear what happened at the oscars lmao") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Have you seen the new Thor trailer?") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("So what'd you think of it") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("What do you think about what's been going on recently") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Should I get Chinese or Italian food?") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("I don't really like spaghetti") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("I mean I like a good chicken alfredo though!") #paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("Tbh the loki show is overrated")  # paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("The new drink at starbucks is so good. I can see the hype.")  # paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("falcon and the winter soldier is probably my favorite out of the new marvel shows, and then wandavision by a slim margin") # paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("I think rina sawayama is literally a pop icon")  # paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)

        self.driver.find_element(By.ID, "send-message-textarea").send_keys("I'll tell you about it some other time. Gotta go!")  # paul
        self.driver.find_element(By.ID, "send-message-textarea").send_keys(Keys.ENTER)

        time.sleep(8)




        # important for conversation data
        heading1 = self.driver.find_elements(By.XPATH, '//*[contains(@id, "-text")]')

        # Grabs all conversation. User and Bot
        messageList = self.getMessages(heading1)

        response = messageList[len(messageList)-1]
        keyword = "favorite color is red"

        self.getSimilarity(response, keyword)

    # Test #2
    def test_test2(self):
        self.driver.get("https://my.replika.com/login")
        self.driver.set_window_size(1200, 900)
        self.driver.find_element(By.ID, "emailOrPhone").send_keys(email)
        self.driver.find_element(By.ID, "emailOrPhone").send_keys(Keys.ENTER)
        time.sleep(1)
        self.driver.find_element(By.ID, "login-password").send_keys(password)
        self.driver.find_element(By.CSS_SELECTOR, ".SolidButton-k70ct8-0").click()
        time.sleep(5)

        self.driver.execute_script("window.scrollTo(0,0)")

